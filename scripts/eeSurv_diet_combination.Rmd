---
title: "eeSurv_diet_combination"
author: "Andrew Jones"
date: "3/3/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Loading PAckages

```{r cars}
library(survival)
library(survminer)
library(splines) #needed by survival package
library(tidyverse) 
library(forcats)
library(cowplot)
library(brms)


source("color_map.R")
source("ggplot_theme.R")
```

## Reading Prcessed Data

```{r pressure, echo=FALSE}
eelifeF <- read.table('~/early_experience/processed/Female_events_eelife.txt',
                     sep = "\t", header = TRUE,
                     stringsAsFactors = FALSE) 

# the diet combination column is stripped in the functions, recreate it
eelifeF <- eelifeF %>%
  unite(lvadComb, larvalTreat, adultTreat, sep = "_", remove = FALSE)

# Male data
eelifeM <- read.table('~/early_experience/processed/Male_events_eelife.txt',
                     sep = "\t", header = TRUE,
                     stringsAsFactors = FALSE) 

# the diet combination column is tripped in the functions, recreate it
eelifeM <- eelifeM %>%
  unite(lvadComb, larvalTreat, adultTreat, sep = "_", remove = FALSE)

```

#Subsetting Into Diet Combinations by Sex
```{r}
CCF <- subset(eelifeF, eelifeF$larvalTreat == "C" & eelifeF$adultTreat == "C")
CDRF <- subset(eelifeF, eelifeF$larvalTreat == "C" & eelifeF$adultTreat == "DR")
DRCF <- subset(eelifeF, eelifeF$larvalTreat == "DR" & eelifeF$adultTreat == "C")
DRDRF <- subset(eelifeF, eelifeF$larvalTreat == "DR" & eelifeF$adultTreat == "DR")

CCM <- subset(eelifeM, eelifeM$larvalTreat == "C" & eelifeM$adultTreat == "C")
CDRM <- subset(eelifeM, eelifeM$larvalTreat == "C" & eelifeM$adultTreat == "DR")
DRCM <- subset(eelifeM, eelifeM$larvalTreat == "DR" & eelifeM$adultTreat == "C")
DRDRM <- subset(eelifeM, eelifeM$larvalTreat == "DR" & eelifeM$adultTreat == "DR")

```


#Survival By Combination
```{r}
eeSurvF <- survfit(Surv(NewAge, status == 2) ~ lvadComb,
                   conf.type = "log", 
                   conf.int = 0.95,
                   type = "kaplan-meier",
                   error = "greenwood",
                   data = eelifeF)

eeSurvM <- survfit(Surv(NewAge, status == 2) ~ lvadComb,
                   conf.type = "log",
                   conf.int = 0.95,
                   type = "kaplan-meier",
                   error = "greenwood",
                   data = eelifeM)

summary(eeSurvF)
summary(eeSurvM)
```

#Getting Median By Itself
```{r}
eeSumF <- summary(eeSurvF)$table[, "median"]


eeSumM <- summary(eeSurvM)$table[, "median"]

idseeF<-strsplit(names(eeSumF), split="=", fixed=TRUE)
idseeM<-strsplit(names(eeSumM), split="=", fixed=TRUE)

```

#Combining Elements into One Data Drame
```{r}
eeMedF<-data.frame('Diet'=unlist(lapply(idseeF, function(x) x[2])),
                   'Median'=eeSumF,'Sex'="Female",stringsAsFactors=FALSE)


eeMedM<-data.frame('Diet'=unlist(lapply(idseeM, function(x) x[2])),
                   'Median'=eeSumM,'Sex'="Male",stringsAsFactors=FALSE)


EETotalSumFM <- rbind(eeMedF, eeMedM)
```

#First Plots
```{r}
ggplot(EETotalSumFM, aes(x = Diet, y = Median, group = Sex, color = Sex)) +
  geom_point() +
  geom_line()

ggplot(EETotalSumFM, aes(x = Diet, y = Median)) +
  geom_boxplot()

ggplot(EETotalSumFM, aes(x = Diet, y = Median, color = Sex)) +
  geom_boxplot(notch = TRUE, notchwidth = .5)
```



