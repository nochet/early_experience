---
title: "Analysis and visualization of fecundity"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(cowplot)
library(colorblindr)
library(forcats)

#source("color_map.R")
source("ggplot_theme.R")
source("color_map_blindr.R")

```

```{r}
eggs <- read.table("~/MyGithub/early_experience/processed/tricount.txt",
            sep = '\t', header = TRUE)

zdn <-eggs %>%  
  select(id,age,cam_id,larvalTreat,adultTreat,
                NstartF,alive,aj1_count,aj2_count,dd1_count,numEggs,
                eggpDay,eggpFemDay)
head(zdn)
```

# Subset by 1) larval diet; 2) adult diet

```{r}
aa <- zdn %>% 
  ggplot(aes(x = age, y = eggpFemDay, color = larvalTreat, group = id)) +
  geom_line() +
  geom_smooth(aes(group = larvalTreat), se = FALSE, color = "black",size=0.8) +
  scale_color_manual(values=c("#999999", "#E69F00"),guide=FALSE) +
  # scale_colour_OkabeIto() +
  # tx_color_map() +
  facet_grid(. ~ larvalTreat) +
  labs(x = "Age (days)", y = "Eggs/female/3hrs") +
  #theme(legend.position = "none") +
  theme_half_open() +
  my_theme
aa <- aa + theme(
  plot.title = element_blank(),
  axis.title.x = element_blank())

bb <- zdn %>%
  ggplot(aes(x = age, y = eggpFemDay, color = adultTreat, group = id)) +
  geom_line() +
  geom_smooth(aes(group = adultTreat), se = FALSE, color = "black") +
  scale_color_manual(values=c("#999999", "#E69F00"),guide=FALSE) +
  #tx_color_map() +
  facet_grid(. ~ adultTreat) +
  labs(x = "Age (days)", y = "Eggs/female/3hrs") +
  #theme(legend.position = "none") +
  theme_half_open() +
  my_theme

bb <- bb + theme(
  plot.title = element_blank(),
  axis.title.x = element_blank())

bb <- bb + theme(strip.background = element_blank(),
           strip.text.x = element_blank())



# Subset by larval-adult diet combinations
zdn$tgroup <- gsub("\\d", "", zdn$id)

cc <- zdn %>% 
  ggplot(aes(x = age, y = eggpFemDay, color = larvalTreat, group = tgroup)) +
  geom_line() +
  geom_smooth(aes(group = larvalTreat), se = FALSE, color = "black",size=0.8) +
  scale_color_manual(values=c("#999999", "#E69F00"),guide=FALSE) +
  # scale_colour_OkabeIto() +
  # tx_color_map() +
  facet_grid(. ~ larvalTreat) +
  labs(x = "Age (days)", y = "Eggs/female/3hrs") +
  #theme(legend.position = "none") +
  theme_half_open() +
  my_theme

cc <- cc + theme(strip.background = element_blank(),
           strip.text.x = element_blank())

# On the same page
library(ggpubr)
eggs <- ggarrange(aa,bb,cc, ncol = 1, nrow = 3, 
                 labels = c("A", "B","C"))

ggsave(eggs,file = "../plots/eggs_perFemale_per3Hrs.pdf",
                width = 4,height=6)

```

# Relationship between lifespan and fecundity

```{r}
# Data written in eeSurv_viz.Rmd
sdata <- read.csv("../processed/survModel_larvAdulSex_declass.csv")
edata <- select(zdn, age,eggpFemDay)
```

